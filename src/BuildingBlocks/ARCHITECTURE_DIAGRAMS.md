# BuildingBlocks Architecture Diagram

## ??? Overall Architecture

```
????????????????????????????????????????????????????????????????????
?                        MICROSERVICES LAYER                        ?
?                                                                   ?
?  ????????????  ????????????  ????????????  ????????????        ?
?  ? Product  ?  ? Customer ?  ? Ordering ?  ? Inventory?        ?
?  ?   .Api   ?  ?   .Api   ?  ?   .Api   ?  ?   .Api   ?   ...  ?
?  ????????????  ????????????  ????????????  ????????????        ?
?       ?             ?             ?             ?                ?
????????????????????????????????????????????????????????????????????
        ?             ?             ?             ?
        ???????????????????????????????????????????
                          ?
        ?????????????????????????????????????
        ?                                   ?
????????????????????????        ????????????????????????
?   CORE LIBRARIES     ?        ?   COMMUNICATION      ?
?                      ?        ?                      ?
? ???????????????????? ?        ? ???????????????????? ?
? ?  Infrastructure  ? ?        ? ? EventBus.Messages? ?
? ?  - Repository    ? ?        ? ? - Product Events ? ?
? ?  - UnitOfWork    ? ?        ? ? - Order Events   ? ?
? ?  - Specification ? ?        ? ? - Inventory      ? ?
? ???????????????????? ?        ? ? - Customer       ? ?
?                      ?        ? ???????????????????? ?
? ???????????????????? ?        ?                      ?
? ?     Shared       ? ?        ? ???????????????????? ?
? ?  - ApiResponse   ? ?        ? ?    Contracts     ? ?
? ?  - Pagination    ? ?        ? ? - Product DTOs   ? ?
? ?  - Extensions    ? ?        ? ? - Category DTOs  ? ?
? ?  - Exceptions    ? ?        ? ? - Supplier DTOs  ? ?
? ???????????????????? ?        ? ? - Interfaces     ? ?
?                      ?        ? ???????????????????? ?
? ???????????????????? ?        ?                      ?
? ? Common.Logging   ? ?        ?                      ?
? ?  - Serilog       ? ?        ?                      ?
? ???????????????????? ?        ?                      ?
????????????????????????        ????????????????????????
```

## ?? BuildingBlocks Dependency Graph

```
Common.Logging (no dependencies)
      ?
      ?
Infrastructure (depends on: EF Core)
      ?
      ?
Shared (no dependencies)
      ?
      ?
Contracts (no dependencies)
      ?
      ?
EventBus.Messages (no dependencies)
      ?
      ?????????????????
                      ?
              ??????????????????
              ?  Product.Api   ?
              ?  (uses all)    ?
              ??????????????????
```

## ?? Data Flow Example

### Creating a Product with Events

```
???????????????
?   Client    ?
???????????????
       ?
       ? POST /api/products
       ?
       ?
????????????????????????????????????????
?         Product.Api                   ?
?                                       ?
?  ???????????????????????????????    ?
?  ?  ProductsController          ?    ?
?  ?  - Receives CreateProductDto ?    ?
?  ?  - Returns ApiResponse<T>    ?    ?
?  ????????????????????????????????    ?
?              ?                        ?
?              ?                        ?
?  ???????????????????????????????    ?
?  ?  ProductRepository           ?    ?
?  ?  - Extends RepositoryBase    ?    ?
?  ?  - Save to Database          ?    ?
?  ????????????????????????????????    ?
?              ?                        ?
?              ?                        ?
?  ???????????????????????????????    ?
?  ?  Event Publisher             ?    ?
?  ?  - ProductCreatedEvent       ?    ?
?  ????????????????????????????????    ?
????????????????????????????????????????
               ?
               ? Publish to RabbitMQ
               ?
               ?
       ?????????????????
       ?   RabbitMQ    ?
       ?   Message Bus ?
       ?????????????????
               ?
       ??????????????????
       ?                ?
       ?                ?
????????????????  ????????????????
? Inventory.Api?  ? Ordering.Api ?
?              ?  ?              ?
? Consumes:    ?  ? Consumes:    ?
? ProductCreated  ? ProductCreated  ?
????????????????  ????????????????
```

## ?? Request/Response Flow with BuildingBlocks

```
HTTP GET /api/products/123
       ?
       ?
????????????????????????????????????????
?  ProductsController                   ?
?  [HttpGet("{id}")]                    ?
?????????????????????????????????????????
             ?
             ? GetByIdAsync(123)
             ?
             ?
????????????????????????????????????????
?  ProductRepository                    ?
?  : RepositoryBase<Product, DbContext> ?
?                                       ?
?  - GetByIdAsync() from base class    ?
?  - Map to ProductDto                  ?
?????????????????????????????????????????
             ?
             ? Query Database
             ?
             ?
????????????????????????????????????????
?  MySQL Database                       ?
?  - Products table                     ?
?????????????????????????????????????????
             ?
             ? Product entity
             ?
             ?
????????????????????????????????????????
?  Mapping & Response                   ?
?  - Map to ProductDto (Contracts)     ?
?  - Wrap in ApiResponse<ProductDto>   ?
?????????????????????????????????????????
             ?
             ? HTTP 200 OK
             ?
             ?
        JSON Response:
        {
          "success": true,
          "message": "Success",
          "data": {
            "id": 123,
            "name": "Gaming Mouse",
            "price": 49.99
          }
        }
```

## ?? BuildingBlocks Usage Matrix

| Service       | Infrastructure | Shared | Contracts | EventBus | Logging |
|---------------|:--------------:|:------:|:---------:|:--------:|:-------:|
| Product.Api   |       ?       |   ?   |     ?    |    ?    |    ?   |
| Customer.Api  |       ?       |   ?   |     ?    |    ?    |    ?   |
| Ordering.Api  |       ?       |   ?   |     ?    |    ?    |    ?   |
| Inventory.Api |       ?       |   ?   |     ?    |    ?    |    ?   |
| Basket.Api    |       ?       |   ?   |     ?    |    ?    |    ?   |
| OcelotApiGw   |       ?       |   ?   |     ?    |    ?    |    ?   |

## ?? Components Detail

### Infrastructure Layer
```
???????????????????????????????????
?      IRepository<T>             ?
?  ????????????????????????????? ?
?  ? GetAllAsync()             ? ?
?  ? GetByIdAsync()            ? ?
?  ? AddAsync()                ? ?
?  ? UpdateAsync()             ? ?
?  ? DeleteAsync()             ? ?
?  ? ExistsAsync()             ? ?
?  ? FindAsync(predicate)      ? ?
?  ????????????????????????????? ?
???????????????????????????????????
         ?
         ? implements
         ?
???????????????????????????????????
?  RepositoryBase<T, TContext>    ?
?  - DbContext                    ?
?  - DbSet<T>                     ?
?  - SaveChangesAsync()           ?
???????????????????????????????????
```

### Event Flow
```
Service A                RabbitMQ               Service B
   ?                        ?                       ?
   ? Publish Event          ?                       ?
   ????????????????????????>?                       ?
   ?                        ?  Subscribe            ?
   ?                        ?<???????????????????????
   ?                        ?                       ?
   ?                        ?  Deliver Event        ?
   ?                        ???????????????????????>?
   ?                        ?                       ?
   ?                        ?  Acknowledge          ?
   ?                        ?<???????????????????????
```

## ?? Color Legend

- ?? Core Libraries (Infrastructure, Shared)
- ?? Communication (EventBus, Contracts)
- ?? Cross-cutting (Common.Logging)
- ?? Services (Product.Api, etc.)

---

**Note**: All diagrams are ASCII-based for easy viewing in any text editor or terminal.
