# BuildingBlocks - Shared Libraries for Microservices

## ?? T?ng quan

BuildingBlocks là t?p h?p các shared libraries ???c s? d?ng chung b?i t?t c? microservices trong h? th?ng. M?c ?ích là:
- ?? **Tái s? d?ng code** - DRY principle
- ?? **Consistency** - ??m b?o tính nh?t quán
- ?? **Faster Development** - Không c?n implement l?i t? ??u
- ??? **Maintainability** - Thay ??i 1 ch?, áp d?ng cho t?t c?

## ?? Các BuildingBlocks

### 1. ??? Infrastructure
**M?c ?ích**: Data Access Layer patterns  
**N?i dung**:
- Generic Repository Pattern
- Unit of Work Pattern  
- Specification Pattern
- Base classes cho DbContext operations

**S? d?ng b?i**: Product.Api, Customer.Api, Ordering.Api, Inventory.Api

[?? Chi ti?t Infrastructure](Infrastructure/README.md)

---

### 2. ?? Shared
**M?c ?ích**: Common utilities & helpers  
**N?i dung**:
- ApiResponse wrapper
- PaginatedResult for pagination
- String/DateTime extensions
- Custom exceptions
- API constants

**S? d?ng b?i**: T?t c? services

[?? Chi ti?t Shared](Shared/README.md)

---

### 3. ?? Contracts
**M?c ?ích**: Shared DTOs & interfaces  
**N?i dung**:
- Product/Category/Supplier DTOs
- Base entity interfaces
- Common contracts gi?a services

**S? d?ng b?i**: Services c?n communicate v?i nhau

[?? Chi ti?t Contracts](Contracts/README.md)

---

### 4. ?? EventBus.Messages
**M?c ?ích**: Event-driven communication  
**N?i dung**:
- RabbitMQ message contracts
- Product/Order/Inventory/Customer events
- Base integration event

**S? d?ng b?i**: Services s? d?ng MassTransit/RabbitMQ

[?? Chi ti?t EventBus.Messages](EventBus.Messages/README.md)

---

### 5. ?? Common.Logging
**M?c ?ích**: Centralized logging configuration  
**N?i dung**:
- Serilog setup
- Console/Debug output formatters
- Enrichers (Machine, Environment, Application)

**S? d?ng b?i**: T?t c? services

---

## ??? Ki?n trúc ph? thu?c

```
???????????????????????????????????????????????????????
?                  Microservices                       ?
?  ??????????????  ??????????????  ??????????????   ?
?  ? Product.Api?  ?Customer.Api?  ? Ordering   ?   ?
?  ?            ?  ?            ?  ?   .Api     ?   ?
?  ??????????????  ??????????????  ??????????????   ?
?        ?               ?               ?            ?
???????????????????????????????????????????????????????
         ?               ?               ?
         ?               ?               ?
???????????????????????????????????????????????????????
?              BuildingBlocks (Shared)                 ?
?  ???????????????  ???????????????  ????????????????
?  ?Infrastructure?  ?   Shared    ?  ?  Contracts  ??
?  ???????????????  ???????????????  ????????????????
?  ???????????????  ???????????????                  ?
?  ?EventBus.Msgs?  ?Common.Logging?                 ?
?  ???????????????  ???????????????                  ?
???????????????????????????????????????????????????????
```

## ?? Cách s? d?ng

### Thêm reference vào service

```xml
<ItemGroup>
  <ProjectReference Include="..\..\BuildingBlocks\Infrastructure\Infrastructure.csproj" />
  <ProjectReference Include="..\..\BuildingBlocks\Shared\Shared.csproj" />
  <ProjectReference Include="..\..\BuildingBlocks\Contracts\Contracts.csproj" />
  <ProjectReference Include="..\..\BuildingBlocks\EventBus.Messages\EventBus.Messages.csproj" />
  <ProjectReference Include="..\..\BuildingBlocks\Common.Logging\Common.Logging.csproj" />
</ItemGroup>
```

### Example: S? d?ng trong Product.Api

```csharp
// 1. Repository from Infrastructure
using Infrastructure.Repositories;

public class ProductRepository : RepositoryBase<Product, ProductContext>, IProductRepository
{
    // Inherit all base CRUD operations
}

// 2. ApiResponse from Shared
using Shared.DTOs;

[HttpGet("{id}")]
public async Task<IActionResult> GetProduct(long id)
{
    var product = await _repository.GetByIdAsync(id);
    return Ok(ApiResponse<ProductDto>.SuccessResult(product));
}

// 3. DTOs from Contracts
using Contracts.DTOs.Product;

public async Task<ProductDto> GetProductDto(long id)
{
    // Use shared DTO
}

// 4. Events from EventBus.Messages
using EventBus.Messages.Events.Product;

await _publishEndpoint.Publish(new ProductCreatedEvent
{
    ProductId = product.Id,
    Name = product.Name
});

// 5. Logging from Common.Logging
using Common.Logging;

builder.Host.UseSerilog(Serilogger.ConfigureLogger);
```

## ? Best Practices

### ? DO:
- S? d?ng BuildingBlocks cho common functionality
- Keep BuildingBlocks generic và reusable
- Document changes trong README
- Version BuildingBlocks n?u có breaking changes

### ? DON'T:
- Business logic trong BuildingBlocks
- Service-specific code trong BuildingBlocks
- Tight coupling gi?a BuildingBlocks và services
- Duplicate code khi ?ã có trong BuildingBlocks

## ?? Dependency Matrix

| Service | Infrastructure | Shared | Contracts | EventBus | Logging |
|---------|---------------|--------|-----------|----------|---------|
| Product.Api | ? | ? | ? | ? | ? |
| Customer.Api | ? | ? | ? | ? | ? |
| Ordering.Api | ? | ? | ? | ? | ? |
| Inventory.Api | ? | ? | ? | ? | ? |
| Basket.Api | ? | ? | ? | ? | ? |
| OcelotApiGw | ? | ? | ? | ? | ? |

## ?? Versioning

Current Version: **1.0.0**

Khi có breaking changes, update version trong `.csproj`:
```xml
<Version>1.1.0</Version>
```

## ?? Contributing

Khi thêm/s?a BuildingBlocks:
1. Update README t??ng ?ng
2. Add tests n?u có logic ph?c t?p
3. Ensure backward compatibility
4. Build toàn b? solution ?? verify

## ?? Roadmap

- [ ] Add FluentValidation base validators
- [ ] Add common middleware (Exception handling)
- [ ] Add API versioning support
- [ ] Add distributed caching abstractions
- [ ] Add authentication/authorization helpers
